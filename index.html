<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0xTanda // Phygital Fashion Store</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Ethers.js v5.7.2 (UMD) - WAJIB V5 -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <!-- Firebase SDK (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Expose Firebase functions to global scope for React
        window.db = null;
        window.auth = null;
        window.addDoc = addDoc;
        window.collection = collection;
        window.serverTimestamp = serverTimestamp;

        // --- KONFIGURASI FIREBASE ---
        // (Pastikan config ini benar saat dideploy)
        const firebaseConfig = window.__firebase_config ? JSON.parse(window.__firebase_config) : {
             apiKey: "API_KEY_ANDA",
             authDomain: "project-id.firebaseapp.com",
             projectId: "project-id",
             storageBucket: "project-id.appspot.com",
             messagingSenderId: "sender-id",
             appId: "app-id"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            
            window.db = db;
            window.auth = auth;
            window.appId = window.__app_id || 'default-app-id';

            const initAuth = async () => {
                try {
                    if (window.__initial_auth_token) {
                        await signInWithCustomToken(auth, window.__initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                    console.log("Firebase Auth: Connected");
                } catch (e) {
                    console.error("Auth Error:", e);
                }
            };
            initAuth();

        } catch (error) {
            console.error("Firebase Init Error:", error);
        }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Space+Grotesk:wght@300;400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            black: '#0E0E0E',
                            white: '#F0F0F0',
                            purple: '#836EF9',
                            green: '#00FF9D',
                            gray: '#A19797',
                            red: '#FF4444'
                        }
                    },
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                        deco: ['Cinzel Decorative', 'serif'],
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0E0E0E; color: #F0F0F0; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0E0E0E; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: #836EF9; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .animate-marquee { animation: marquee 40s linear infinite; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ==========================================
    // 1. CUSTOM HOOK: useWallet
    // Single Source of Truth untuk Logic Wallet
    // ==========================================
    const useWallet = () => {
        const [address, setAddress] = useState(null);
        const [provider, setProvider] = useState(null);
        const [signer, setSigner] = useState(null);
        const [isConnecting, setIsConnecting] = useState(false);
        const [error, setError] = useState(null);

        // Reset state helper
        const resetState = () => {
            setAddress(null);
            setProvider(null);
            setSigner(null);
            setError(null);
        };

        const connect = async () => {
            setIsConnecting(true);
            setError(null);

            // Cek 1: Apakah window.ethereum ada?
            if (typeof window.ethereum === "undefined") {
                setIsConnecting(false);
                const msg = "Wallet tidak ditemukan! Install MetaMask, OKX, atau Rabby.";
                alert(msg);
                setError(msg);
                return;
            }

            try {
                // Cek 2: Request Accounts (Trigger Popup)
                console.log("Requesting accounts...");
                const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                
                if (!accounts || accounts.length === 0) {
                    throw new Error("No accounts returned.");
                }

                // Cek 3: Setup Ethers v5 Provider
                // Menggunakan Web3Provider (v5 standard)
                const _provider = new ethers.providers.Web3Provider(window.ethereum, "any");
                const _signer = _provider.getSigner();
                const _address = await _signer.getAddress();

                console.log("Connected:", _address);

                // Update State
                setProvider(_provider);
                setSigner(_signer);
                setAddress(_address);

            } catch (err) {
                console.error("Connection Error:", err);
                let errMsg = "Gagal menghubungkan wallet.";
                
                if (err.code === 4001) {
                    errMsg = "Koneksi dibatalkan oleh user (Rejected).";
                } else if (err.code === -32002) {
                    errMsg = "Request pending. Buka extension wallet Anda manual.";
                }

                alert(errMsg);
                setError(errMsg);
                resetState();
            } finally {
                setIsConnecting(false);
            }
        };

        const disconnect = () => {
            // Client-side disconnect (reset UI only)
            // MetaMask tidak mengizinkan full disconnect via API
            resetState();
        };

        // Listen for account changes
        useEffect(() => {
            if (window.ethereum) {
                const handleAccountsChanged = (accounts) => {
                    if (accounts.length === 0) {
                        disconnect();
                    } else if (address !== accounts[0]) {
                        // Re-connect logic for new account to update signer
                        window.location.reload(); // Simple reload to refresh state cleanly
                    }
                };

                const handleChainChanged = () => {
                    window.location.reload();
                };

                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);

                return () => {
                    if(window.ethereum.removeListener) {
                        window.ethereum.removeListener('accountsChanged', handleAccountsChanged);
                        window.ethereum.removeListener('chainChanged', handleChainChanged);
                    }
                };
            }
        }, [address]);

        return {
            address,
            provider,
            signer,
            isConnecting,
            error,
            connect,
            disconnect,
            isConnected: !!address
        };
    };

    // --- ICONS (Static SVG) ---
    const Icon = ({ children, size = 24, className, ...props }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
    );
    const ArrowRight = (props) => <Icon {...props}><path d="M5 12h14" /><path d="m12 5 7 7-7 7" /></Icon>;
    const Check = (props) => <Icon {...props}><path d="M20 6 9 17l-5-5" /></Icon>;
    const Copy = (props) => <Icon {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></Icon>;
    const Loader2 = (props) => <Icon {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></Icon>;
    const Menu = (props) => <Icon {...props}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></Icon>;
    const ShoppingBag = (props) => <Icon {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><path d="M3 6h18" /><path d="M16 10a4 4 0 0 1-8 0" /></Icon>;
    const Shield = (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></Icon>;
    const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></Icon>;
    const LogOut = (props) => <Icon {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></Icon>;
    const Key = (props) => <Icon {...props}><path d="m21 2-2 2m-7.6 7.6a6 6 0 1 1-4.2-4.2"/><circle cx="8" cy="8" r="3"/><line x1="8" x2="8" y1="8" y2="8"/></Icon>;
    const Fingerprint = (props) => <Icon {...props}><path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"/><path d="M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2"/><path d="M8.65 22c.21-.66.45-1.32.57-2"/><path d="M9 12a3 3 0 0 1 3-3"/><path d="M11 21.5c.5-1.5.5-3 .5-4.5"/><path d="M15 22c-.2-.6-.4-1.2-.5-2"/><path d="M18 21.5c-.25-.75-.5-1.5-.6-2.25"/><path d="M19.75 16.5c.25-.75.5-1.5.6-2.25"/></Icon>;

    // --- ASSETS & DATA ---
    const ASSETS = {
        logoMain: "https://github.com/aabrur/0xTanda-/blob/main/Logo/500x500/0xTanda%20Brand%20Logo%20(Remove%20Background).png?raw=true",
    };

    // (Produk Data Sama)
    const PRODUCTS = [
        { id: 1, name: "GENESIS TEE // 16S", priceIDR: 149000, type: "Heavyweight T-Shirt", desc: "Spesifikasi Industrial: Cotton Combed 16s (235-250 gsm).", nftBenefit: "Sertifikat Keaslian Digital + Kartu Koleksi Fisik", imgPhysical: "https://placehold.co/600x800/1a1a1a/white?text=GENESIS+TEE+16s", imgNFT: "https://placehold.co/600x800/836EF9/white?text=ART+COLLECTION" },
        { id: 2, name: "PROTOKOL HOODIE", priceIDR: 499000, type: "Heavyweight Hoodie", desc: "Fleece tebal anti-angin. Potongan oversized.", nftBenefit: "Sertifikat Keaslian Digital + Akses Event", imgPhysical: "https://placehold.co/600x800/2a2a2a/white?text=PROTOKOL+HOODIE", imgNFT: "https://placehold.co/600x800/836EF9/white?text=ART+COLLECTION" },
        { id: 3, name: "ENKRIPSI CAP", priceIDR: 189000, type: "Headwear", desc: "Profil Dad Hat klasik. Bordir logo ikon 'X'.", nftBenefit: "Digital Membership Card", imgPhysical: "https://placehold.co/600x800/000000/white?text=ENKRIPSI+CAP", imgNFT: "https://placehold.co/600x800/836EF9/white?text=ART+COLLECTION" }
    ];

    // ==========================================
    // COMPONENTS
    // ==========================================

    const VerticalLine = ({ className = "" }) => <div className={`w-1.5 h-12 bg-brand-purple rounded-full inline-block ${className}`}></div>;

    const Marquee = () => (
        <div className="bg-brand-purple text-black font-sans text-xs py-1 overflow-hidden whitespace-nowrap border-b border-brand-purple select-none z-50 relative">
            <div className="animate-marquee inline-block font-bold tracking-wider">
                // 0xTanda // GENESIS BATCH: LIVE // ONE ENTITY // DUAL EXISTENCE // PHYGITAL STREETWEAR INDONESIA //
            </div>
        </div>
    );

    // NAVBAR: Menggunakan Props wallet dari useWallet hook
    const Navbar = ({ setPage, cartCount, wallet }) => {
        const [menuOpen, setMenuOpen] = useState(false);
        const { isConnected, address, connect, disconnect, isConnecting } = wallet;

        const formatAddress = (addr) => addr ? `${addr.substring(0, 6)}...${addr.substring(addr.length - 4)}` : '';

        return (
            <nav className="fixed top-8 left-0 w-full z-40 px-6 mix-blend-difference text-brand-white">
                <div className="flex justify-between items-center max-w-7xl mx-auto">
                    <div onClick={() => setPage('home')} className="cursor-pointer flex items-center gap-2">
                        <img src={ASSETS.logoMain} alt="0xTanda" className="h-12 md:h-16 object-contain" />
                    </div>
                    
                    <div className="hidden md:flex gap-8 font-mono text-sm">
                        <button onClick={() => setPage('home')} className="hover:text-brand-purple tracking-wider">BERANDA</button>
                        <button onClick={() => setPage('shop')} className="hover:text-brand-purple tracking-wider">KOLEKSI</button>
                        <button onClick={() => setPage('verify')} className="hover:text-brand-purple tracking-wider">VERIFIKASI</button>
                    </div>

                    <div className="flex items-center gap-4">
                        {/* LOGIC BUTTON WALLET */}
                        {!isConnected ? (
                            <button 
                                onClick={connect} 
                                disabled={isConnecting}
                                className="border border-brand-purple px-4 py-2 text-xs font-mono hover:bg-brand-purple hover:text-black transition-all flex items-center gap-2"
                            >
                                {isConnecting ? <Loader2 className="animate-spin" size={14}/> : <Zap size={14}/>}
                                {isConnecting ? "CONNECTING..." : "CONNECT WALLET"}
                            </button>
                        ) : (
                            <div className="flex items-center gap-2 border border-brand-green px-4 py-2 bg-brand-black/50 backdrop-blur-md">
                                <div className="w-2 h-2 bg-brand-green rounded-full animate-pulse"></div>
                                <span className="text-xs font-mono text-brand-green">{formatAddress(address)}</span>
                                <button onClick={disconnect} className="ml-2 hover:text-red-500 transition-colors" title="Disconnect">
                                    <LogOut size={14}/>
                                </button>
                            </div>
                        )}

                        <div className="relative cursor-pointer hover:text-brand-purple" onClick={() => setPage('checkout')}>
                            <ShoppingBag size={20} />
                            {cartCount > 0 && <span className="absolute -top-2 -right-2 bg-brand-purple text-black text-[10px] w-4 h-4 flex items-center justify-center font-bold rounded-sm">{cartCount}</span>}
                        </div>
                    </div>
                </div>
            </nav>
        );
    };

    // ==========================================
    // PAGE: VERIFY (Revised)
    // Hash -> Connect -> Sign -> Success
    // ==========================================
    const VerifyPage = ({ wallet }) => {
        const [step, setStep] = useState(1);
        const [hashInput, setHashInput] = useState("");
        const [isSigning, setIsSigning] = useState(false);
        const [claimData, setClaimData] = useState(null);

        const { isConnected, connect, signer, address } = wallet;

        // Step 1 -> 2: Validate Hash
        const handleCheckHash = () => {
            if (!hashInput.trim()) return alert("Masukkan kode hash terlebih dahulu.");
            // (Optional) Validasi format hash sederhana
            setStep(2);
        };

        // Step 2 -> 3: handled by wallet.isConnected check in render

        // Step 3 -> 4: Sign Message
        const handleSignClaim = async () => {
            if (!signer) return alert("Wallet error. Refresh halaman.");
            
            setIsSigning(true);
            try {
                const timestamp = Date.now();
                // Format pesan yang akan di-sign (Off-chain proof)
                const message = `VERIFIKASI KEPEMILIKAN 0xTANDA\n\nHash Produk: ${hashInput}\nWallet: ${address}\nTimestamp: ${timestamp}\n\nDengan ini saya menyatakan kepemilikan fisik produk ini.`;
                
                // Trigger Signature Popup
                const signature = await signer.signMessage(message);
                
                console.log("Signature:", signature);
                
                // Simpan data (Simulasi sukses)
                setClaimData({
                    hash: hashInput,
                    address: address,
                    signature: signature,
                    timestamp: new Date(timestamp).toLocaleString()
                });
                
                setStep(4);
            } catch (err) {
                console.error("Sign Error:", err);
                if(err.code === 4001) {
                    alert("Signature Rejected. Anda harus sign untuk klaim.");
                } else {
                    alert("Gagal melakukan sign. Coba lagi.");
                }
            } finally {
                setIsSigning(false);
            }
        };

        return (
            <div className="min-h-screen bg-brand-black pt-28 pb-12 px-6 flex flex-col items-center justify-center">
                <div className="max-w-md w-full animate-fade-in border border-[#333] p-8 bg-[#121212] relative overflow-hidden">
                    
                    {/* Background Effect */}
                    <div className="absolute top-0 right-0 w-32 h-32 bg-brand-purple/5 rounded-full blur-3xl pointer-events-none"></div>

                    <div className="flex items-center gap-3 mb-6">
                        <Shield className="text-brand-purple" />
                        <h2 className="text-2xl font-sans font-bold uppercase tracking-wider text-brand-white">Verifikasi</h2>
                    </div>

                    {/* Progress Bar */}
                    <div className="flex justify-between mb-8 relative">
                        <div className="absolute top-1/2 left-0 w-full h-[1px] bg-[#333] -z-10"></div>
                        {[1, 2, 3, 4].map((s) => (
                            <div key={s} className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-mono border ${step >= s ? 'bg-brand-purple text-black border-brand-purple' : 'bg-[#1a1a1a] text-brand-gray border-[#333]'}`}>
                                {s}
                            </div>
                        ))}
                    </div>

                    {/* STEP 1: INPUT HASH */}
                    {step === 1 && (
                        <div className="space-y-4">
                            <p className="text-brand-gray font-mono text-xs mb-4">Masukkan Kode Unik (Hash) yang tertera pada kartu fisik Anda.</p>
                            <div>
                                <label className="text-xs text-brand-purple font-bold block mb-2">PRODUCT HASH CODE</label>
                                <div className="relative">
                                    <Key className="absolute left-3 top-3 text-brand-gray" size={16}/>
                                    <input 
                                        type="text" 
                                        value={hashInput}
                                        onChange={(e) => setHashInput(e.target.value)}
                                        placeholder="Contoh: GEN-X99-001"
                                        className="w-full bg-black border border-[#333] py-3 pl-10 pr-4 text-brand-white font-mono text-sm focus:border-brand-purple outline-none uppercase tracking-widest"
                                    />
                                </div>
                            </div>
                            <button onClick={handleCheckHash} className="w-full bg-brand-white text-black py-3 font-bold font-mono hover:bg-brand-purple transition-all">
                                LANJUT
                            </button>
                        </div>
                    )}

                    {/* STEP 2: CONNECT WALLET */}
                    {step === 2 && (
                        <div className="space-y-6 text-center">
                            <p className="text-brand-gray font-mono text-xs">Untuk memverifikasi keaslian, kami memerlukan tanda tangan digital dari wallet Anda.</p>
                            
                            {!isConnected ? (
                                <div className="border border-dashed border-brand-gray/30 p-6 rounded-lg">
                                    <div className="mb-4 flex justify-center"><Zap size={32} className="text-brand-gray"/></div>
                                    <button onClick={connect} className="w-full bg-transparent border border-brand-purple text-brand-purple py-3 font-bold font-mono hover:bg-brand-purple hover:text-black transition-all flex items-center justify-center gap-2">
                                        CONNECT WALLET
                                    </button>
                                </div>
                            ) : (
                                <div className="bg-brand-green/10 border border-brand-green p-4 rounded-lg">
                                    <div className="flex items-center gap-2 text-brand-green text-sm font-bold font-mono mb-2 justify-center">
                                        <div className="w-2 h-2 bg-brand-green rounded-full animate-pulse"></div>
                                        WALLET TERHUBUNG
                                    </div>
                                    <div className="text-xs text-brand-gray font-mono break-all">{address}</div>
                                    <button onClick={() => setStep(3)} className="w-full mt-4 bg-brand-green text-black py-3 font-bold font-mono hover:brightness-110 transition-all">
                                        LANJUT KLAIM
                                    </button>
                                </div>
                            )}
                            
                            <button onClick={() => setStep(1)} className="text-xs text-brand-gray underline hover:text-white">Kembali</button>
                        </div>
                    )}

                    {/* STEP 3: SIGN MESSAGE */}
                    {step === 3 && (
                        <div className="space-y-6">
                             <div className="bg-[#1a1a1a] p-4 border border-[#333] text-xs font-mono space-y-2">
                                <div className="flex justify-between"><span className="text-brand-gray">HASH:</span> <span className="text-white">{hashInput}</span></div>
                                <div className="flex justify-between"><span className="text-brand-gray">WALLET:</span> <span className="text-white">{address.substring(0,8)}...</span></div>
                             </div>
                             
                             <div className="text-center">
                                <Fingerprint size={48} className="mx-auto text-brand-purple mb-4 animate-pulse"/>
                                <p className="text-brand-gray font-mono text-xs mb-6">Klik tombol di bawah. Wallet Anda akan meminta persetujuan Signature (Biaya Gas: Rp 0).</p>
                                
                                <button 
                                    onClick={handleSignClaim} 
                                    disabled={isSigning}
                                    className="w-full bg-brand-purple text-black py-3 font-bold font-mono hover:bg-white transition-all flex items-center justify-center gap-2"
                                >
                                    {isSigning ? <Loader2 className="animate-spin"/> : <Key size={16}/>}
                                    {isSigning ? "MEMINTA SIGNATURE..." : "SIGN & KLAIM KEPEMILIKAN"}
                                </button>
                             </div>
                        </div>
                    )}

                    {/* STEP 4: SUCCESS */}
                    {step === 4 && claimData && (
                        <div className="text-center space-y-6 animate-fade-in">
                            <div className="w-20 h-20 bg-brand-green/20 border border-brand-green rounded-full flex items-center justify-center mx-auto">
                                <Check size={40} className="text-brand-green" />
                            </div>
                            <div>
                                <h3 className="text-2xl font-bold font-sans text-brand-white mb-1">TERVERIFIKASI</h3>
                                <p className="text-brand-gray font-mono text-xs">Produk ini adalah 100% Otentik.</p>
                            </div>

                            <div className="bg-black border border-brand-green/30 p-4 text-left space-y-3 overflow-hidden">
                                <div>
                                    <label className="text-[10px] text-brand-gray block">TIMESTAMP</label>
                                    <div className="text-xs font-mono text-brand-green">{claimData.timestamp}</div>
                                </div>
                                <div>
                                    <label className="text-[10px] text-brand-gray block">SIGNATURE HASH</label>
                                    <div className="text-[10px] font-mono text-brand-gray break-all bg-[#111] p-2 border border-[#333]">
                                        {claimData.signature.substring(0, 30)}...
                                    </div>
                                </div>
                            </div>
                            
                            <p className="text-[10px] text-brand-gray italic">"Bukti ini disimpan secara kriptografis."</p>

                            <button onClick={() => {setStep(1); setHashInput('');}} className="w-full border border-[#333] text-brand-gray py-3 text-xs font-mono hover:border-brand-white hover:text-white transition-all">
                                VERIFIKASI PRODUK LAIN
                            </button>
                        </div>
                    )}
                </div>
            </div>
        );
    };

    // --- LANDING PAGE & SHOP (Sama tapi disederhanakan untuk konteks file ini) ---
    const LandingPage = ({ setPage }) => (
        <div className="relative w-full h-screen flex flex-col items-center justify-center overflow-hidden bg-brand-black">
          <div className="z-10 text-center flex flex-col items-center gap-6 px-4 fade-in-up">
            <VerticalLine className="mb-4" />
            <div className="font-sans text-brand-purple text-xs tracking-[0.5em] uppercase font-bold">ONE ENTITY // DUAL EXISTENCE</div>
            <div className="mb-4 hover:scale-105 transition-transform duration-500"><img src={ASSETS.logoMain} alt="0xTanda" className="h-32 md:h-56 object-contain filter drop-shadow-[0_0_15px_rgba(131,110,249,0.3)]" /></div>
            <p className="font-mono text-brand-gray max-w-md text-xs md:text-sm mb-10 leading-relaxed tracking-wide">GENESIS BATCH: 14 UNIT.<br/>SERTIFIKASI ON-CHAIN.</p>
            <button onClick={() => setPage('shop')} className="group px-8 py-4 bg-transparent border border-brand-white text-brand-white font-mono text-sm hover:bg-brand-purple hover:border-brand-purple hover:text-black transition-all duration-300 flex items-center gap-2">LIHAT KOLEKSI <ArrowRight size={16} className="group-hover:translate-x-1 transition-transform"/></button>
          </div>
        </div>
    );

    const ShopPage = ({ setPage }) => (
        <div className="min-h-screen bg-brand-black pt-28 pb-12 px-6">
          <div className="max-w-7xl mx-auto">
            <h2 className="text-3xl font-bold text-brand-white mb-8">KOLEKSI</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              {PRODUCTS.map((product) => (
                <div key={product.id} className="border border-[#333] p-4 hover:border-brand-purple cursor-pointer" onClick={() => setPage('verify')}>
                    <img src={product.imgPhysical} className="w-full mb-4 grayscale hover:grayscale-0 transition-all"/>
                    <h3 className="text-white font-bold">{product.name}</h3>
                    <p className="text-brand-purple text-xs mt-2">Rp {product.priceIDR.toLocaleString()}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
    );

    const CheckoutPage = () => <div className="min-h-screen pt-32 text-center text-white">Fitur Checkout disederhanakan untuk demo Wallet.</div>;

    // ==========================================
    // MAIN APP
    // ==========================================
    const App = () => {
        const [page, setPage] = useState('home');
        const [cart, setCart] = useState([]);
        
        // Panggil Hook di Level Teratas
        const wallet = useWallet();

        return (
            <div className="bg-brand-black min-h-screen text-brand-white selection:bg-brand-purple selection:text-black font-mono">
                <Marquee />
                
                {/* Pass wallet state ke Navbar */}
                <Navbar setPage={setPage} cartCount={cart.length} wallet={wallet} />
                
                <main className="relative z-10 fade-in-up">
                    {page === 'home' && <LandingPage setPage={setPage} />}
                    {page === 'shop' && <ShopPage setPage={setPage} />}
                    {page === 'checkout' && <CheckoutPage />}
                    {/* Pass wallet state ke VerifyPage */}
                    {page === 'verify' && <VerifyPage wallet={wallet} />}
                </main>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
    </script>
</body>
</html>
